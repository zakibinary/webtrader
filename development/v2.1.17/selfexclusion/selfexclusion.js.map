{"version":3,"sources":["../../../../src/selfexclusion/selfexclusion.es6"],"names":["win","timerHandlerForSessionTimeout","loginTime","limits","i18n","settingsData","max_balance","max_turnover","max_losses","max_7day_turnover","max_7day_losses","max_30day_turnover","max_30day_losses","max_open_bets","session_duration_limit","exclude_until","timeout_until_date","timeout_until_time","trimString","event","scope","$el","target","decimals","currencyFractionalDigits","length","attr","r","RegExp","val","toString","match","field","update","data","message","time_out","time","add","format","console","log","isAfter","push","timeout_until","unix","each","index","value","set","utc","isBefore","startOf","indexOf","name","limit","undefined","forEach","msg","i","growl","error","confirm","window","send","then","response","notice","logoutBasedOnExcludeDateAndTimeOut","setOrRefreshTimer","catch","err","init_win","require","Promise","res","div","find","datepicker","dateFormat","minDate","toDate","maxDate","timepicker","timeFormat","createBlankWindow","title","width","minHeight","height","destroy","appendTo","bind","refreshData","defer","invalidate","valueOf","get_self_exclusion","isUndefined","isNull","isFinite","toNumber","clearTimeout","logoutAfter_ms","now","Math","pow","setTimeout","logout","dialog","addClass","events","on","cached","authorize","is_virtual","removeClass","init","$menuLink","click","hasClass","moveToTop"],"mappings":"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","file":"selfexclusion.js","sourcesContent":["/**\n * Created by arnab on 4/5/16.\n */\nimport $ from \"jquery\";\nimport windows from \"windows/windows\";\nimport liveapi from \"websockets/binary_websockets\";\nimport _ from \"lodash\";\nimport rv from \"common/rivetsExtra\";\nimport moment from \"moment\";\nimport html from \"text!selfexclusion/selfexclusion.html\";\nimport \"jquery-growl\";\nimport \"common/util\";\n\n\nlet win = null,\n    timerHandlerForSessionTimeout = null,\n    loginTime = null;\nconst limits = {\n    \"max_balance\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"Maximum balance\".i18n()\n    },\n    \"max_turnover\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"Daily turnover limit\".i18n()\n    },\n    \"max_losses\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"Daily limit on losses\".i18n()\n    },\n    \"max_7day_turnover\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"7-day turnover limit\".i18n()\n    },\n    \"max_7day_losses\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"7-day limit on losses\".i18n()\n    },\n    \"max_30day_turnover\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"30-day turnover limit\".i18n()\n    },\n    \"max_30day_losses\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"30-day limit on losses\".i18n()\n    },\n    \"max_open_bets\": {\n        \"limit\": 101,\n        \"set\": false,\n        \"name\": \"Maximum open positions\".i18n()\n    },\n    \"session_duration_limit\": {\n        \"limit\": 60480,\n        \"set\": false,\n        \"name\": \"Session duration limit\".i18n()\n    },\n    \"exclude_until\": {\n        \"limit\": null,\n        \"set\": false,\n        \"name\": \"Exclude time\".i18n()\n    },\n    \"timeout_until\": {\n        \"limit\": null,\n        \"set\": false,\n        \"name\": \"Time out until\".i18n()\n    }\n};\n\nconst settingsData = {\n    max_balance: null,\n    max_turnover: null,\n    max_losses: null,\n    max_7day_turnover: null,\n    max_7day_losses: null,\n    max_30day_turnover: null,\n    max_30day_losses: null,\n    max_open_bets: null,\n    session_duration_limit: null,\n    exclude_until: null,\n    timeout_until_date: null,\n    timeout_until_time: null,\n    trimString: (event, scope) => {\n        const $el = $(event.target),\n            decimals = currencyFractionalDigits(),\n            length = $el.attr('maxlength'),\n            r = new RegExp(`[\\\\d]{0,20}(\\\\.[\\\\d]{1,${decimals}})?`, \"g\"),\n            val = ($el.val().toString().match(r) || [])[0],\n            field = $el.attr('rv-value');\n        scope[field] = val;\n    },\n    update: function(event, scope) {\n\n        const data = { \"set_self_exclusion\": 1 };\n        let message = [];\n\n        if (scope.timeout_until_date) {\n\n            const time_out = moment(scope.timeout_until_date);\n            if (scope.timeout_until_time) {\n                const time = moment(scope.timeout_until_time, \"HH:mm\");\n                time_out.add(time.format('HH'), 'hours')\n                    .add(time.format('mm'), 'minutes');\n                console.log(time_out, time.format('HH'),time.format('mm'));\n            }\n            if (time_out.isAfter(moment().add(6, \"weeks\"))) {\n                message.push(\"Please enter a value less than 6 weeks for time out until.\".i18n());\n            }\n            if (!time_out.isAfter(moment())) {\n                message.push(\"Exclude time must be after today.\".i18n());\n            }\n            scope.timeout_until = time_out.unix();\n        } else {\n            if (scope.timeout_until_time) {\n                message.push(\"Please select a date for time out until.\".i18n());\n            }\n        }\n\n\n        //validation\n        $.each(limits, function(index, value) {\n            scope[index] = scope[index] && scope[index].toString();\n            if (scope[index] || value.set) {\n                if (index === \"exclude_until\") {\n                    if(moment.utc(scope.exclude_until, \"YYYY-MM-DD\").isBefore(moment.utc().startOf('day').add(6, \"months\"))){\n                        message.push(\"Exclude until time cannot be less than 6 months.\".i18n());\n                        return;\n                    }\n                    if(moment.utc(scope.exclude_until, \"YYYY-MM-DD\").isAfter(moment.utc().startOf('day').add(5, \"years\"))){\n                        message.push(\"Exclude until time cannot be more than 5 years.\".i18n());\n                        return;\n                    }\n                }\n                if(scope[index] && scope[index].indexOf(\"e\")!==-1) {\n                    message.push(\"Please enter a valid value for \".i18n() + value.name);\n                    return;\n                }\n                if (!scope[index] || scope[index] <= 0 || (value.limit && scope[index] > value.limit)) {\n                    message.push(\"Please enter a value between 0 and \".i18n() + value.limit + \" for \".i18n() + value.name);\n                    return;\n                }\n\n                data[index] = scope[index];\n            } else {\n                scope[index] = undefined;\n            }\n        });\n\n        if (message.length > 0) {\n            message.forEach(function(msg, i) {\n                $.growl.error({ message: msg });\n            })\n            return;\n        }\n        if (data.timeout_until || data.exclude_until) {\n            const confirm = window.confirm(\"When you click \\\"Ok\\\" you will be excluded from trading on the site until the selected date.\".i18n());\n            if (confirm == false) {\n                return;\n            }\n        }\n\n        liveapi.send(data)\n            .then(function(response) {\n                $.growl.notice({ message: 'Your changes have been updated'.i18n() });\n                logoutBasedOnExcludeDateAndTimeOut();\n                setOrRefreshTimer();\n            })\n            .catch(function(err) {\n                $.growl.error({ message: err.message });\n                console.error(err);\n            });\n    }\n};\n\nconst init_win = function() {\n    require([\"css!selfexclusion/selfexclusion.css\"]);\n    return new Promise(function(res) {\n        const div = $(html).i18n();\n        div.find(\".datepicker\").datepicker({\n            dateFormat: 'yy-mm-dd',\n            minDate: moment.utc().toDate(),\n            maxDate: moment.utc().add(6, \"weeks\").toDate()\n        });\n        div.find(\".timepicker\").timepicker({\n            timeFormat: 'HH:MM'\n        });\n        win = windows.createBlankWindow($('<div/>'), {\n            title: 'Self-Exclusion Facilities'.i18n(),\n            width: 900,\n            minHeight: 500,\n            height: 500,\n            'data-authorized': 'true',\n            destroy: function() {\n                win = null;\n            }\n        });\n        div.appendTo(win);\n        rv.bind(div[0], settingsData);\n        refreshData();\n        res();\n    });\n};\n\nfunction logoutBasedOnExcludeDateAndTimeOut() {\n    if (settingsData.exclude_until) {\n        if (moment.utc(settingsData.exclude_until, 'YYYY-MM-DD').isAfter(moment.utc().startOf('day'))) {\n            _.defer(function() {\n                $.growl.error({ message: 'You have excluded yourself until '.i18n() + settingsData.exclude_until });\n                liveapi.invalidate();\n            });\n        }\n    }\n    if (settingsData.timeout_until) {\n        if (moment(settingsData.timeout_until).isAfter(moment().unix().valueOf())) {\n            $.growl.error({ message: 'You have excluded yourself until '.i18n() + moment.unix(settingsData.timeout_until).utc().format(\"YYYY-MM-DD HH:mm\") + \"GMT\" });\n            liveapi.invalidate();\n        }\n    }\n}\n\nconst refreshData = function() {\n    $.growl.notice({ message: 'Loading self-exclusion settings.'.i18n() });\n    return liveapi\n        .send({ get_self_exclusion: 1 })\n        .then(function(response) {\n            if (response.get_self_exclusion) {\n                $.each(limits, function(index, value) {\n                    settingsData[index] = response.get_self_exclusion[index];\n                    if (response.get_self_exclusion[index]) {\n                        limits[index].limit = response.get_self_exclusion[index];\n                        limits[index].set = true;\n                    }\n                });\n\n                logoutBasedOnExcludeDateAndTimeOut();\n            }\n        })\n        .catch(function(err) {\n            $.growl.error({ message: err.message });\n            console.error(err);\n        });\n};\n\nconst setOrRefreshTimer = function() {\n\n    if (_.isUndefined(settingsData.session_duration_limit) || _.isNull(settingsData.session_duration_limit) || !_.isFinite(_.toNumber(settingsData.session_duration_limit))) return;\n\n    if (timerHandlerForSessionTimeout) clearTimeout(timerHandlerForSessionTimeout);\n    let logoutAfter_ms = settingsData.session_duration_limit * 60 * 1000;\n    //reduce time elapsed since login\n    logoutAfter_ms -= _.now() - loginTime;\n    //setTimeout works with 32 bit value. Anything more than that does not work. 32 bit value is around 49 days\n    //User cannot be active on website for 49 days, so we are setting the session time out to 49 days max\n    if (logoutAfter_ms > Math.pow(2, 32)) { logoutAfter_ms = Math.pow(2, 32); }\n    timerHandlerForSessionTimeout = setTimeout(function() {\n        $.growl.error({ message: 'Logging out because of self-exclusion session time out!'.i18n() });\n        liveapi.invalidate();\n    }, logoutAfter_ms);\n\n};\n\nconst logout = function() {\n    if (win) win.dialog('destroy');\n    win = null;\n    if (timerHandlerForSessionTimeout) clearTimeout(timerHandlerForSessionTimeout)\n    timerHandlerForSessionTimeout = null;\n    loginTime = null;\n    settingsData.max_balance = null;\n    settingsData.max_turnover = null;\n    settingsData.max_losses = null;\n    settingsData.max_7day_turnover = null;\n    settingsData.max_7day_losses = null;\n    settingsData.max_30day_turnover = null;\n    settingsData.max_30day_losses = null;\n    settingsData.max_open_bets = null;\n    settingsData.session_duration_limit = null;\n    settingsData.exclude_until = null;\n    $(\".resources a.selfexclusion\").addClass('disabled');\n};\n\nliveapi.events.on('login', function(data) {\n    liveapi.cached.authorize()\n        .then(function(data) {\n            if (!data.authorize.is_virtual) {\n                loginTime = _.now();\n                refreshData().then(function() {\n                    setOrRefreshTimer();\n                });\n                $(\"#nav-menu a.selfexclusion\").removeClass('disabled');\n            } else {\n                logout();\n            }\n        })\n        .catch(function(err) {\n            logout();\n        });\n});\nliveapi.events.on('logout', logout);\n\nexport const init = function($menuLink) {\n    $menuLink.click(function() {\n        if (!$(this).hasClass('disabled')) {\n            liveapi.cached.authorize()\n                .then(function() {\n                    if (!win) {\n                        init_win().then(function() {\n                            win.dialog('open');\n                        });\n                    } else {\n                        refreshData();\n                        win.moveToTop();\n                    }\n                })\n                .catch(function(err) {\n                    console.error(err);\n                });\n        }\n    });\n}\n\nexport default {\n    init\n}\n"]}