{"version":3,"sources":["../../../../src/trade/tradeDialog.es6"],"names":["init","require","replacer","field_name","value","obj","debounce","formatters","apply_fixes","available","filter","each","sortBy","row","rank","find","val","key","i18n","contract_category_display","contract_display","trading_times_for","yyyy_mm_dd","symbol","cached","send","trading_times","then","data","times","open","close","markets","forEach","market","submarkets","sub","symbols","sym","catch","err","console","error","get_current_template","state","name","template","categories_value","categories","categoriy_displays_selected","category_displays","selected","date_start_value","date_start","digits_value","digits","duration_value","duration","duration_count_value","duration_count","duration_unit_value","duration_unit","expiry_value_hour","date_expiry","value_hour","expiry_value_date","value_date","expiry_value","barriers_barrier_count","barriers","barrier_count","barriers_barrier","barrier","barriers_high_barrier","high_barrier","barriers_low_barrier","low_barrier","basis_value","basis","currency_value","currency","basis_amount","amount","spreads_amount_per_point","spreads","amount_per_point","spreads_stop_type","stop_type","spreads_stop_loss","stop_loss","spreads_stop_profit","stop_profit","set_current_template","tpl","warn","msg","growl","message","array","contract_category","defer","type","sentiment","visible","some","is_today","utc","isAfter","init_state","root","dialog","contracts_for_spot","is_champion","isChampionFx","ranges","min","max","text","format","today_times","disabled","onHourShow","hour","now","close_hour","open_hour","onMinuteShow","minute","close_minute","open_minute","paddingTop","paddings","perv_barrier","was_perv_barrier_daily","perv_high_barrier","was_perv_high_barrier_daily","perv_low_barrier","was_perv_low_barrier_daily","barrier_live","tick","quote","high_barrier_live","low_barrier_live","decimal","currencyFractionalDigits","limit","spread","spot","spot_time","deposit_","epoch","perv_quote","down","ans","ticks","loading","proposal","symbol_name","display_name","last_promise","id","ask_price","display_value","payout","netprofit_","formatPrice","payout_","purchase","tooltips","my","at","collision","barrier_p","openHelp","notice","showSpecificContent","update_currency","is_authenticated","payout_currencies","hide","e","target","closest","length","toggle","update_times","expiry","range","head","add","update","category","map","uniq","y","x","category_object","push","onclick","attr","forward_starting_options","spot_starting_options","assign","model","later","Date","getTime","i","step","from","Math","ceil","d","getUTCHours","slice","getUTCMinutes","getUTCDay","options","date_or_hour","unix","onchange","includes","start_type","durations","r","min_contract_duration","max_contract_duration","expiry_type","daily","replace","min_unit","last","max_unit","sort_dict","sort","r1","r2","try_to_keep_value","subcat","match","differ","under","over","unit","update_barrier","new_barrier","sign","is_daily","def_barrier","test","result","update_limit","payout_limit","request","subscribe","contract_type","barrier2","forget","new_proposal_promise","update_track","get_template","show","div","appendTo","css","left","remove","extra","category_display","pip","show_tick_chart","tick_count","tradeConf","buy","price","contract_id","transaction_id","proposal_open_contract","code","invalidate","contract_object","tick_stream_alive","events","on","shift","longcode","contracts_for","saved_template","isTrackerInitiated","createBlankWindow","title","width","resizable","collapsable","minimizable","maximizable","relativePosition","unregister","view","unbind","destroy","track","module_id","is_unique","keyFor","has_digits","register","granularity","style","delay","bind","undefined","set_template","hide_template_menu","tradeTemplateManager"],"mappings":"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","file":"tradeDialog.js","sourcesContent":["/**\n * Created by amin on November 18, 2015.\n */\n\n/* init(...) parameters => The symbol is in the following format:\n     symbol = {\n        symbol: \"frxXAUUSD\",\n        display_name: \"Gold/USD\",\n        delay_amount: 0,\n        settlement: \"\",\n        feed_license: \"realtime\",\n        events: [{ dates: \"Fridays\", descrip: \"Closes early (at 21:00)\" }, { dates: \"2015-11-26\", descrip: \"Closes early (at 18:00)\" }],\n        times: { open: [\"00:00:00\"], close: [\"23:59:59\"], settlement: \"23:59:59\" },\n        pip: \"0.001\"\n      },\n\n  The contracts_for is in the following format:\n    contracts_for = {\n        open: 1447801200,\n        close: 1447822800,\n        hit_count: 14,\n        spot: \"5137.20\",\n        available: [\n            {\n                market: \"indices\",                  contract_display: \"higher\",\n                min_contract_duration: \"1d\",        max_contract_duration: \"365d\",\n                barriers: 0,                        sentiment: \"up\",\n                barrier_category: \"euro_atm\",       start_type: \"spot\",\n                contract_category: \"callput\",       submarket: \"asia_oceania\",\n                exchange_name: \"ASX\",               expiry_type: \"daily\",\n                underlying_symbol: \"AS51\",          contract_category_display: \"Up/Down\",\n                contract_type: \"CALL\"\n            }]\n    }\n*/\n\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport windows from 'windows/windows';\nimport rv from 'common/rivetsExtra';\nimport liveapi from 'websockets/binary_websockets';\nimport chartingRequestMap from 'charts/chartingRequestMap';\nimport html from 'text!trade/tradeDialog.html';\nimport 'css!trade/tradeDialog.css';\nimport 'timepicker';\nimport 'jquery-ui';\nimport 'common/util';\nimport help from 'help/help';\n\nrequire(['trade/tradeConf']); /* trigger async loading of trade Confirmation */\nvar replacer = function (field_name, value) { return function (obj) { obj[field_name] = value; return obj; }; };\nvar debounce = rv.formatters.debounce;\n\nfunction apply_fixes(available){\n    /* fix for server side api, not seperating higher/lower frim rise/fall in up/down category */\n    _(available).filter({\n      'contract_category': 'callput',\n      'barrier_category' : 'euro_atm',\n      'barriers': 0,\n      'sentiment': 'up'\n    }).each(replacer('contract_display', 'rise'));\n\n    _(available).filter({\n      'contract_category': 'callput',      \n      'barrier_category': 'euro_atm',\n      'barriers': 0,\n      'sentiment': 'down'\n    }).each(replacer('contract_display','fall'));\n    /* fix for server side api, returning two different contract_category_displays for In/Out */\n    _(available).filter(['contract_category', 'staysinout'])\n                .each(replacer('contract_category_display', 'In/Out'));\n    _(available).filter(['contract_category', 'endsinout'])\n                .each(replacer('contract_category_display', 'In/Out'));\n    /* fix for websocket having a useless barrier value for digits */\n    _(available).filter(['contract_category', 'digits'])\n                .each(replacer('barriers', 0));\n    /* fix for contract_display text in In/Out menue */\n    _(available).filter({\"contract_type\": \"EXPIRYMISS\"}).each(replacer('contract_display', 'ends out'));\n    _(available).filter({\"contract_type\": \"EXPIRYRANGE\"}).each(replacer('contract_display', 'ends in'));\n    _(available).filter({\"contract_type\": \"RANGE\"}).each(replacer('contract_display', 'stays in'));\n    _(available).filter({\"contract_type\": \"UPORDOWN\"}).each(replacer('contract_display', 'goes out'));\n    _(available).filter({\"contract_type\": \"ONETOUCH\"}).each(replacer('contract_display', 'touch'));\n    _(available).filter({\"contract_type\": \"NOTOUCH\"}).each(replacer('contract_display', 'no touch'));\n\n    /* sort the items in the array according to the way we want to show them */\n    available = _.sortBy(available,function(row){\n      var rank = _.find({ 'Up/Down': 1, 'Touch/No Touch':2, 'In/Out': 3, 'Digits': 4, 'Asians': 5, 'Spreads': 6 },\n        (val, key) => {\n          if(key.i18n() == row.contract_category_display || key == row.contract_category_display){\n            return val;\n          }\n        }\n      );\n      if(rank === 4) { /* Digits */\n        rank = {'odd': 4, 'even' : 4.5}[row.contract_display] || 3.5;\n      }\n      return rank\n    });\n\n    return available;\n}\n\n/* get open and close time for a symbol trading_times */\nfunction trading_times_for(yyyy_mm_dd, symbol) {\n    return liveapi.cached\n           .send({trading_times: yyyy_mm_dd})\n           .then(function(data){\n              var times = { open : '--', close: '--'};\n              data.trading_times.markets.forEach(function(market){\n                  market.submarkets.forEach(function(sub){\n                    sub.symbols.forEach(function(sym){\n                      if(sym.symbol === symbol) {\n                        times = {open: sym.times.open[0], close: sym.times.close[0]};\n                      }\n                    });\n                  });\n              });\n              return times;\n           })\n           .catch(function(err){\n             console.error(err);\n             return { open : '--', close: '--'};\n           });\n}\n\n/* return the current state of dialog as a template */\nfunction get_current_template(state) {\n  return {\n    name: state.template.name,\n    categories_value: state.categories.value,\n    categoriy_displays_selected: state.category_displays.selected,\n    date_start_value: state.date_start.value,\n    digits_value: state.digits.value,\n    duration_value: state.duration.value,\n    duration_count_value: state.duration_count.value,\n    duration_unit_value: state.duration_unit.value,\n    expiry_value_hour: state.date_expiry.value_hour,\n    expiry_value_date: state.date_expiry.value_date,\n    expiry_value: state.date_expiry.value,\n    barriers_barrier_count: state.barriers.barrier_count,\n    barriers_barrier: state.barriers.barrier,\n    barriers_high_barrier: state.barriers.high_barrier,\n    barriers_low_barrier: state.barriers.low_barrier,\n    basis_value: state.basis.value,\n    currency_value: state.currency.value,\n    basis_amount: state.basis.amount,\n    spreads_amount_per_point: state.spreads.amount_per_point,\n    spreads_stop_type: state.spreads.stop_type,\n    spreads_stop_loss: state.spreads.stop_loss,\n    spreads_stop_profit: state.spreads.stop_profit\n  };\n};\n\nfunction set_current_template(state, tpl) {\n  state.template.name = tpl.name;\n  var warn = function(msg) { $.growl.error({ message: msg || 'Template applied partially.'.i18n() }); }\n  if(!_.find(state.categories.array, tpl.categories_value)) {\n    $.growl.error({ message: 'Template is not applicable.'.i18n() });\n    return;\n  }\n  state.categories.selected = tpl.categories_value.contract_category;\n  _.defer(function() {\n    if(!_.find(state.category_displays.array, \n      type => type.name===tpl.categoriy_displays_selected.name && type.sentiment===tpl.categoriy_displays_selected.sentiment)) {\n      warn();\n      return;\n    }\n    state.category_displays.selected = tpl.categoriy_displays_selected;\n    _.defer(function() {\n      if(state.date_start.visible) {\n        _.defer(function() {\n          if(tpl.date_start_value !== 'now' && _.some(state.date_start.array, {value: tpl.date_start_value*1}))\n            state.date_start.value = tpl.date_start_value*1;\n          else\n            state.date_start.value = 'now';\n        });\n      }\n      if(state.digits.visible) {\n        state.digits.value = tpl.digits_value;\n      }\n      if(state.categories.value.contract_category !== 'spreads') { /* <----- duration */\n        state.duration.value = tpl.duration_value;\n        if(state.duration.value === 'Duration' ) {\n          _.defer(function() {\n            state.duration_unit.value = tpl.duration_unit_value;\n            _.defer(function() {\n              state.duration_count.value = tpl.duration_count_value;\n            });\n          });\n        }\n        if(state.duration.value === 'End Time') {\n          _.defer(function() {\n              state.date_expiry.value_date = tpl.expiry_value_date;\n              var is_today = !moment.utc(state.date_expiry.value_date).isAfter(moment.utc(),'day');\n              if(is_today) {\n                _.defer(function() {\n                  state.date_expiry.value_hour = tpl.expiry_value_hour;\n                });\n              }\n          });\n        }\n      } /* <---- duration */\n\n      state.barriers.barrier_count = tpl.barriers_barrier_count;\n      if(state.barriers.barrier_count === 1) {\n        _.defer(function() {\n          state.barriers.barrier = tpl.barriers_barrier;\n        });\n      }\n      if(state.barriers.barrier_count === 2) {\n        _.defer(function() {\n          state.barriers.high_barrier = tpl.barriers_high_barrier;\n          state.barriers.low_barrier = tpl.barriers_low_barrier;\n        });\n      }\n      /* <---- barriers */\n\n      if(state.categories.value.contract_category !== 'spreads') {\n        _.defer(function() {\n          state.basis.value = tpl.basis_value;\n          state.currency.value = tpl.currency_value;\n          state.basis.amount = tpl.basis_amount;\n        });\n      } /* <----- basis, currency */\n\n      if(state.categories.value.contract_category === 'spreads') {\n          state.currency.value = tpl.currency_value;\n          state.spreads.amount_per_point = tpl.spreads_amount_per_point;\n          state.spreads.stop_type = tpl.spreads_stop_type;\n          state.spreads.stop_loss = tpl.spreads_stop_loss;\n          state.spreads.stop_profit = tpl.spreads_stop_profit;\n\n      } /* <---- Spreads */\n    });\n  })\n}\n\nfunction init_state(available,root, dialog, symbol, contracts_for_spot){\n\n  var state = {\n    is_champion: isChampionFx(),\n    duration: {\n      array: ['Duration', 'End Time'],\n      value: 'Duration',\n    },\n    duration_unit: {\n      array: [''],\n      ranges: [{min: 1, max:365}],\n      value: '',\n    },\n    duration_count: {\n      value: 1,\n      min: 1,\n      max: 365\n    },\n    date_start: {\n      value: 'now', /* epoch value if selected */\n      array: [{ text: 'Now', value: 'now' } ],\n      visible: false,\n    },\n    date_expiry: {\n      value_date: moment.utc().format('YYYY-MM-DD'), /* today utc in yyyy-mm-dd format */\n      value_hour: moment.utc().format('HH:mm'), /* now utc in hh:mm format */\n      value: 0,    /* epoch value of date+hour */\n      today_times: { open: '--', close: '--', disabled: false }, /* trading times for today */\n      onHourShow: function(hour) { /* for timepicker */\n        var times = state.date_expiry.today_times;\n        if(times.open === '--') return true;\n        var now = moment.utc();\n        var close_hour = moment(times.close, \"HH:mm:ss\").hour();\n        var open_hour = moment(times.open, \"HH:mm:ss\").hour();\n        if(now.hour() >= open_hour && now.hour() <= close_hour ) { open_hour =  now.hour(); }\n        return (hour >= open_hour && hour <= close_hour) ||\n               (hour <= close_hour && close_hour <= open_hour) ||\n               (hour >= open_hour && open_hour >= close_hour);\n      },\n      onMinuteShow: function(hour,minute){\n        var times = state.date_expiry.today_times;\n        if(times.open === '--') return true;\n        var now = moment.utc();\n        var close_hour = moment(times.close, \"HH:mm:ss\").hour(),\n            close_minute = moment(times.close, \"HH:mm:ss\").minute();\n        var open_hour = moment(times.open, \"HH:mm:ss\").hour(),\n            open_minute = moment(times.open, \"HH:mm:ss\").minute();\n        if(now.hour() >= open_hour && now.hour() <= close_hour ) {\n          open_hour =  now.hour();\n          open_minute = now.minute();\n        }\n        if(open_hour === hour) return minute >= open_minute;\n        if(close_hour === hour) return minute <= close_minute;\n        return (hour > open_hour && hour < close_hour) || hour < close_hour || hour > open_hour;\n      }\n    },\n    categories: {\n      array: [],\n      value: '',\n      paddingTop: function(){\n        var paddings = { \"asian\" : '26px', \"callput\" : '8px', \"digits\" : '14px', \"endsinout\" : '4px', \"staysinout\" : '4px', \"touchnotouch\" : '12px' , \"spreads\":'5px' };\n        return paddings[state.categories.value.contract_category] || '3px';\n      }\n    },\n    category_displays: {\n      array: [],\n      selected: ''\n    },\n    barriers: {\n      barrier_count: 0,\n      barrier : '',\n      perv_barrier: '', // previous barrier value for intraday and tick contracts.\n      was_perv_barrier_daily: false, // was the perv barrier a daily one?\n      high_barrier: '',\n      perv_high_barrier: '',\n      was_perv_high_barrier_daily: false,\n      low_barrier: '',\n      perv_low_barrier: '',\n      was_perv_low_barrier_daily: false,\n      barrier_live: function() { return this.barrier * 1 + state.tick.quote * 1; },\n      high_barrier_live: function() { return this.high_barrier * 1 + state.tick.quote * 1; },\n      low_barrier_live: function() { return this.low_barrier * 1 + state.tick.quote * 1; },\n    },\n    digits: {\n      array: ['0', '1','2','3','4','5','6','7','8','9'],\n      value: '0',\n      visible: false,\n      text: 'Last Digit Prediction'.i18n()\n    },\n    currency: {\n      array: ['USD'],\n      value: 'USD',\n      decimal: currencyFractionalDigits()\n    },\n    basis: {\n      array: ['Payout', 'Stake'],\n      value: 'payout',\n      amount: currencyFractionalDigits() === 8 ? 0.10000000 : 10,\n      limit: null,\n    },\n    spreads: {\n      amount_per_point: 1,\n      stop_type: 'point', /* could be 'point' or 'dollar' */\n      stop_loss: (_.find(available, 'stop_loss') || { stop_loss: 10}).stop_loss,\n      stop_profit: (_.find(available, 'stop_profit') || { stop_profit: 10}).stop_profit,\n      /* updated from #proposal websocket api */\n      spread: 0.0,\n      spot: '0.0',\n      spot_time: '0',\n      deposit_: function(){\n        if(this.stop_type === 'point')\n          return this.stop_loss * this.amount_per_point;\n        else // 'dollar'\n          return this.stop_loss;\n      }\n    },\n    tick: {\n      epoch: '0',\n      quote: contracts_for_spot,\n      perv_quote: '0',\n      down: function(){\n        var ans= this.quote*1 < this.perv_quote*1;\n        return ans;\n      }\n    },\n    ticks: {\n      array: [], /* ticks for sparkline chart */\n      loading: true,\n    },\n    proposal: {\n      symbol: symbol.symbol,\n      symbol_name: symbol.display_name,\n      last_promise: null,\n      id: '', /* id of last proposal request sent */\n      ask_price: \"0.0\",\n      date_start: 0,\n      display_value: \"0.0\",\n      message: 'Loading ...'.i18n(), /* longcode */\n      payout: 0,\n      spot: \"0.0\",\n      spot_time: \"0\",\n      error: '',\n      loading: true, /* the proposal request state */\n\n      /* computed properties */\n      netprofit_: function () {\n        return formatPrice(((this.payout - this.ask_price) || 0), state.currency.value);\n      },\n      payout_: function () {\n        return formatPrice((+this.payout || 0), state.currency.value);\n      }\n    },\n    purchase: {\n      loading: false, /* is the purchased button clicked and confirmation dialog is loading */\n    },\n    tooltips: {\n      barrier: { my: \"left-215 top+10\", at: \"left bottom\", collision: \"flipfit\" },\n      barrier_p: { my: \"left-5 top+10\", at: \"left bottom\", collision: \"flipfit\" },\n    },\n    template: {\n      name: '',\n      visible: false,\n    },\n    openHelp: ()=>{\n      $.growl.notice({message:\"Loading help text for \".i18n() + state.categories.value.contract_category_display});\n      help.showSpecificContent(state.categories.value.contract_category_display);\n    }\n  };\n\n  var update_currency = function() {\n    /* change currency on user login */\n    if(liveapi.is_authenticated()) {\n      liveapi.send({payout_currencies: 1})\n             .then(function(data){\n               state.currency.value = data.payout_currencies[0];\n               state.currency.array = data.payout_currencies;\n            })\n             .catch(function(err) { console.error(err); });\n    }\n  };\n\n  state.template.hide = function(e) {\n    if($(e.target).closest('.trade-template-manager').length === 0) {\n      state.template.visible = false;\n    }\n  }\n  state.template.toggle = function() {\n    state.template.visible = !state.template.visible;\n  }\n\n  state.barriers.root = state; // reference to root object for computed properties\n\n  state.date_expiry.update_times = function(){\n      trading_times_for(state.date_expiry.value_date, state.proposal.symbol)\n        .then(function(times) {\n          var expiry = state.date_expiry;\n          expiry.today_times.open = times.open;\n          expiry.today_times.close = times.close;\n          var range = _(state.duration_unit.ranges).filter(['type', 'minutes']).head();\n          expiry.today_times.disabled = !range;\n          var value_hour = range ? moment.utc().add(range.min+1, 'm').format('HH:mm') : \"00:00\";\n          expiry.value_hour = value_hour > expiry.value_hour ? value_hour : expiry.value_hour;\n          // /* avoid 'Contract may not expire within the last 1 minute of trading.' */\n          // value_hour = moment(times.close, 'HH:mm:ss').subtract(1, 'minutes').format('HH:mm');\n          // expiry.value_hour = value_hour < expiry.value_hour ? value_hour : expiry.value_hour;\n      });\n  }\n\n  state.categories.update = function (msg) {\n    state.categories.value = _.find(state.categories.array,{contract_category: state.categories.selected});\n    var category = state.categories.value.contract_category;\n    state.category_displays.array = [];\n    _(available).filter(['contract_category', category]).map('contract_display').uniq().value().forEach(\n      x => {\n        let y = {};\n        y.name = x;\n        let category_object = _.find(available, {contract_display:x});\n        if (category_object)\n          y.sentiment = category_object.sentiment;\n\n        state.category_displays.array.push(y);\n    });\n    state.category_displays.selected = _.head(state.category_displays.array);\n  };\n\n  state.category_displays.onclick = function (e) {\n    state.category_displays.selected = {};\n    state.category_displays.selected.name = $(e.target).attr('data-name');\n    state.category_displays.selected.sentiment = $(e.target).attr('data-sentiment');\n  };\n\n  state.date_start.update = function () {\n    var forward_starting_options = _(available).filter({\n      'contract_category_display': state.categories.value.contract_category_display,\n      'contract_display': state.category_displays.selected.name,\n      'start_type': 'forward'\n    }).head();\n    // For markets with spot start_type\n    var spot_starting_options = _(available).filter({\n      'contract_category_display': state.categories.value.contract_category_display,\n      'contract_display': state.category_displays.selected.name,\n      'start_type': 'spot'\n    }).head();\n\n    if (!forward_starting_options) {\n      _.assign(state.date_start, { visible: false, array: [], value: 'now' });\n      return;\n    };\n\n    forward_starting_options = forward_starting_options.forward_starting_options\n    var model = state.date_start;\n    var array = [];\n    // Add 'NOW' to start time only if the market contains spot start_type.\n    if(spot_starting_options){\n      array = [{ text: 'Now', value: 'now' }];\n    }\n    var later = (new Date().getTime() + 5*60*1000)/1000; // 5 minute from now\n    for(var i = 0; i < forward_starting_options.length; i++){\n      var row = forward_starting_options[i];\n      var step = 5 * 60; // 5 minutes step\n      var from = Math.ceil(Math.max(later, row.open) / step) * step;\n      for (var epoch = from; epoch < row.close; epoch += step) {\n        var d = new Date(epoch * 1000);\n        var text = (\"00\" + d.getUTCHours()).slice(-2) + \":\" +\n        (\"00\" + d.getUTCMinutes()).slice(-2) + ' ' +\n        ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][d.getUTCDay()];\n        array.push({ text: text, value: epoch });\n      }\n    }\n    var options = { value: array[0].value, array: array, visible: true };\n    if(_.some(array, {value: state.date_start.value*1})) {\n      options.value = state.date_start.value;\n    }\n    _.assign(state.date_start, options);\n  };\n\n  state.date_expiry.update = function (date_or_hour) {\n    var expiry = state.date_expiry;\n    /* contracts that are more not today must end at the market close time */\n    var is_today = !moment.utc(expiry.value_date).isAfter(moment.utc(),'day');\n    if(!is_today){\n        expiry.today_times.disabled = true;\n        trading_times_for(expiry.value_date, state.proposal.symbol)\n          .then(function(times){\n            var value_hour = times.close !== '--' ? times.close : '00:00:00';\n            expiry.value_hour = moment(value_hour, \"HH:mm:ss\").format('HH:mm');\n            expiry.value = moment.utc(expiry.value_date + \" \" + value_hour).unix();\n            state.barriers.update();\n            debounce(expiry.value, state.proposal.onchange);\n          });\n    }\n    else {\n        if(date_or_hour !== expiry.value_hour) { expiry.update_times(); }\n        expiry.value = moment.utc(expiry.value_date + \" \" + expiry.value_hour).unix();\n        state.barriers.update();\n        debounce(expiry.value, state.proposal.onchange);\n    }\n  }\n\n  state.duration.update = function () {\n    var category = state.categories.value.contract_category;\n    if (_([\"callput\", \"endsinout\", \"staysinout\", \"touchnotouch\"]).includes(category)) {\n      if(state.duration.array.length !== 2)\n        state.duration.array = ['Duration', 'End Time'];\n    }\n    else {\n      state.duration.value = 'Duration';\n      if(state.duration.array.length !== 1)\n        state.duration.array = ['Duration'];\n    }\n  };\n\n  state.duration_unit.update = function () {\n    var start_type = state.date_start.value !== 'now' ? 'forward' : 'spot';\n\n    var durations = _(available).filter({\n      'contract_category_display': state.categories.value.contract_category_display,\n      'contract_display': state.category_displays.selected.name,\n      'start_type': start_type\n    })\n    .map(function (r) {\n      return {\n        min: r.min_contract_duration + '',\n        max: r.max_contract_duration + '',\n        type: r.expiry_type\n      }\n    }).value();\n\n    var array = [];\n    var ranges = [];\n    _.each(durations, function (d) {\n      if (_(['tick', 'daily']).includes(d.type)) {\n        array.push({ tick: 'ticks', daily: 'days' }[d.type]);\n        ranges.push({\n          min: d.min.replace('d', '').replace('t','') | 0,\n          max: d.max.replace('d', '').replace('t','') | 0,\n          type: { tick: 'ticks', daily: 'days' }[d.type]\n        });\n        return;\n      }\n      /* fix intraday duration intervals */\n      var min = d.min.replace('s', '').replace('m', '').replace('h',''),\n          max = d.max.replace('s', '').replace('m', '').replace('h','').replace('d', '');\n      var min_unit = _(d.min).last(),\n          max_unit = _(d.max).last();\n\n      min *= { 's': 1, 'm': 60, 'h': 3600 }[min_unit];                 // convert to seconds\n      max *= { 's': 1, 'm': 60, 'h':3600, 'd': 3600 * 24 }[max_unit];\n\n      if('s' === min_unit) {\n        array.push('seconds');\n        ranges.push({ min: min, max: max, type: 'seconds'});\n      }\n      if(_(['s', 'm']).includes(min_unit) && max >= 60) {\n        array.push('minutes');\n        ranges.push({ min: Math.max(min / 60, 1), max: max / 60, type: 'minutes' });\n      }\n      if(_(['s', 'm', 'h']).includes(min_unit) && max >= 3600) {\n        array.push('hours');\n        ranges.push({ min: Math.max(min / 3600, 1), max: max / 3600, type: 'hours' });\n      }\n    });\n\n    /* sort the arrays */\n    var sort_dict = { 'ticks': 0, 'seconds': 1, 'minutes': 2, 'hours': 3, 'days': 4 };\n    array.sort(function (r1, r2) { return sort_dict[r1] - sort_dict[r2]; });\n    ranges.sort(function(r1,r2){ return sort_dict[r1.type] - sort_dict[r2.type]; })\n\n    if (!array.length) {\n      state.barriers.update();\n      return;\n    }\n\n    state.duration_unit.ranges = ranges;\n    if(!_.includes(array,state.duration_unit.value)){\n      state.duration_unit.value = _.head(array);\n    }\n    else {\n      state.duration_count.update(true);\n    }\n\n    state.duration_unit.array = array;\n\n    /* manualy notify 'duration_count' and 'barriers' to update themselves */\n    state.barriers.update();\n    state.date_expiry.update_times();\n  };\n\n  state.duration_count.update = function (try_to_keep_value) {\n    var range = _(state.duration_unit.ranges).filter({'type': state.duration_unit.value}).head();\n    if (!range) return;\n    state.duration_count.min = range.min;\n    state.duration_count.max = range.max;\n    if(try_to_keep_value !== true) {\n      state.duration_count.value = range.min;\n    }\n    else if(state.duration_count.value < range.min || state.duration_count.value > range.max) {\n      state.duration_count.value = range.min;\n    }\n  };\n\n  state.digits.update = function() {\n      var subcat = state.category_displays.selected.sentiment;\n      if(state.categories.value.contract_category !== 'digits' || subcat === 'odd' || subcat === 'even') {\n        state.digits.visible = false;\n        return;\n      }\n\n      var array = {\n        match: ['0', '1','2','3','4','5','6','7','8', '9'],\n        differ: ['0', '1','2','3','4','5','6','7','8', '9'],\n        under: ['1','2','3','4','5','6','7','8', '9'],\n        over: ['0','1','2','3','4','5','6','7','8'],\n      }[subcat];\n      var text = {\n        match: 'Last Digit Prediction'.i18n(),\n        differ: 'Last Digit Prediction'.i18n(),\n        under: 'Last Digit is Under'.i18n(),\n        over: 'Last Digit is Over'.i18n()\n      }[subcat];\n\n      if(!_.includes(array, state.digits.value)){\n        state.digits.value = array[0];\n      }\n      state.digits.array = array;\n      state.digits.text = text;\n      state.digits.visible = true;\n  };\n\n  state.barriers.update = function () {\n    var unit = state.duration_unit.value;\n    var expiry_type = _(['seconds', 'minutes', 'hours']).includes(unit) ? 'intraday' : unit === 'days' ? 'daily' : 'tick';\n    var barriers = _(available).filter({\n      'contract_category_display': state.categories.value.contract_category_display,\n      'contract_display': state.category_displays.selected.name,\n      'expiry_type':expiry_type\n    }).filter(function (r) { return r.barriers >= 1; }).head();\n\n    state.barriers.barrier_count = barriers ? barriers.barriers : 0;\n    if (!barriers)\n      return;\n\n     var update_barrier = function(barrier, perv_barrier, new_barrier, was_perv_barrier_daily, sign) {\n        var is_daily = (expiry_type === 'daily' && state.duration.value !== 'End Time') ||\n           (state.duration.value === 'End Time' && moment.utc(state.date_expiry.value_date).isAfter(moment.utc(),'day'));\n        if(is_daily) {\n           if(was_perv_barrier_daily) {\n              perv_barrier = barrier;\n           }\n           barrier = (was_perv_barrier_daily ? barrier : 0) || new_barrier;\n           was_perv_barrier_daily = true;\n        }\n        else {\n           var def_barrier = (new_barrier*1 >= 0 ? sign : '') + new_barrier*1;\n           if(was_perv_barrier_daily && /^[+-]/.test(perv_barrier)) {\n              barrier = perv_barrier;\n           }\n           else if(!/^[+-]/.test(barrier)) {\n              barrier = def_barrier;\n           }\n           else {} // no need to update it\n           perv_barrier = barrier;\n           was_perv_barrier_daily = false;\n        }\n        return {\n           barrier: barrier,\n           perv_barrier: perv_barrier,\n           was_perv_barrier_daily: was_perv_barrier_daily\n        };\n     }\n    if(barriers.barrier) {\n       var result = update_barrier(state.barriers.barrier, state.barriers.perv_barrier,\n          barriers.barrier, state.barriers.was_perv_barrier_daily, '+');\n       state.barriers.barrier = result.barrier;\n       state.barriers.perv_barrier = result.perv_barrier;\n       state.barriers.was_perv_barrier_daily = result.was_perv_barrier_daily;\n    }\n    if(barriers.high_barrier){\n       var result = update_barrier(state.barriers.high_barrier, state.barriers.perv_high_barrier,\n          barriers.high_barrier, state.barriers.was_perv_high_barrier_daily, '+');\n       state.barriers.high_barrier = result.barrier;\n       state.barriers.perv_high_barrier = result.perv_barrier;\n       state.barriers.was_perv_high_barrier_daily = result.was_perv_barrier_daily;\n    }\n    if(barriers.low_barrier){\n       var result = update_barrier(state.barriers.low_barrier, state.barriers.perv_low_barrier,\n          barriers.low_barrier, state.barriers.was_perv_low_barrier_daily, '-');\n       state.barriers.low_barrier = result.barrier;\n       state.barriers.perv_low_barrier = result.perv_barrier;\n       state.barriers.was_perv_low_barrier_daily = result.was_perv_barrier_daily;\n    }\n  };\n\n  state.basis.update_limit = function () {\n    var basis = state.basis;\n    var limit = _(available).filter({\n      'contract_category_display': state.categories.value.contract_category_display,\n      'contract_display': state.category_displays.selected.name\n    }).head();\n\n    limit = (limit && limit.payout_limit) || null;\n    basis.limit = limit ? (limit * 1) : null;\n    if(basis.limit) {\n      basis.amount = Math.min(basis.amount, basis.limit);\n    }\n  };\n\n  state.proposal.onchange = function () {\n    var unit = state.duration_unit.value;\n    var expiry_type = _(['seconds', 'minutes', 'hours']).includes(unit) ? 'intraday' : unit === 'days' ? 'daily' : 'tick';\n    if(state.categories.value.contract_category === 'spreads') expiry_type = 'intraday';\n    var row = _(available).filter({\n      'contract_category_display': state.categories.value.contract_category_display,\n      'contract_display': state.category_displays.selected.name,\n      'expiry_type': expiry_type\n    }).head();\n    var request = {\n      proposal: 1,\n      subscribe: 1,\n      contract_type: row.contract_type,\n      currency: state.currency.value, /* This can only be the account-holder's currency */\n      symbol: state.proposal.symbol, /* Symbol code */\n    };\n    if(state.categories.value.contract_category !== 'spreads') {\n      request.amount = state.basis.amount*1; /* Proposed payout or stake value */\n      request.basis = state.basis.value; /* Indicate whether amount is 'payout' or 'stake */\n    } else {\n      request.amount_per_point = state.spreads.amount_per_point;\n      request.stop_type = state.spreads.stop_type;\n      request.stop_loss = state.spreads.stop_loss;\n      request.stop_profit = state.spreads.stop_profit;\n    }\n    /* set the value for barrier(s) */\n    if (state.barriers.barrier_count == 1) {\n      request.barrier = state.barriers.barrier;\n    }\n    if (state.barriers.barrier_count == 2) {\n      request.barrier = state.barriers.high_barrier;\n      request.barrier2 = state.barriers.low_barrier + '';\n    }\n    if (state.categories.value.contract_category === 'digits') {\n      request.barrier = state.digits.value + '';\n    }\n    if (state.date_start.value !== 'now') {\n      request.date_start = state.date_start.value * 1;\n    }\n    /* set value for duration or date_expiry */\n    if (state.duration.value === 'Duration') {\n      request.duration_unit = _(state.duration_unit.value).head(); //  (d|h|m|s|t), Duration unit is s(seconds), m(minutes), h(hours), d(days), t(ticks)\n      if(state.duration_count.value < 1) {\n        state.duration_count.value = 1;\n        return;\n      }\n      request.duration = state.duration_count.value * 1;\n    }\n    else {\n      request.date_expiry = state.date_expiry.value;\n    }\n\n    state.proposal.loading = true;\n    /* forget previous proposal request */\n    if(state.proposal.last_promise) {\n      state.proposal.last_promise.then(function(data){\n        var id = data && data.proposal && data.proposal.id;\n        id && liveapi.send({forget: id});\n      });\n    }\n\n    var new_proposal_promise = liveapi.send(request)\n      .then(function (data) {\n        /* OK, this is the last sent request */\n        if(new_proposal_promise === state.proposal.last_promise) {\n          var id = data.proposal && data.proposal.id;\n          state.proposal.error = '';\n          state.proposal.id = id;\n        }\n        return data;\n      })\n      .catch(function (err) {\n        console.error(err);\n        state.proposal.error = err.message;\n        state.proposal.message = '';\n        state.proposal.loading = false;\n        return err;\n      });\n    /* update last_promise to invalidate previous requests */\n    state.proposal.last_promise = new_proposal_promise;\n    state.proposal.id = ''; /* invalidate last proposal.id */\n\n    dialog.update_track(dialog.get_template());\n  };\n\n  state.purchase.onclick = async function() {\n    state.purchase.loading = true;\n    var show = function(div){\n      div.appendTo(root);\n\n      root.find('.trade-fields').css({ left : '350px'});\n      root.find('.trade-conf').css({ left : '0'});\n      // root.find('.trade-fields').animate({ left : '+=350'}, 1000, 'linear');\n      // root.find('.trade-conf').animate({ left : '+=350'}, 1000, 'linear');\n    };\n    var hide = function(div){\n      root.find('.trade-fields').css({ left : '0'});\n      root.find('.trade-conf').css({ left : '-350px'});\n      // root.find('.trade-fields').animate({ left : '-=350'}, 500, 'linear');\n      // root.find('.trade-conf').animate({ left : '-=350'}, 500, 'linear', function(){ ... });\n      state.purchase.loading = false;\n      div.remove();\n      /* trigger a new proposal stream */\n      state.proposal.onchange();\n    }\n    \n    /* workaround for api not providing this fields */\n    var extra = {\n        currency: state.currency.value,\n        symbol: state.proposal.symbol,\n        symbol_name: state.proposal.symbol_name,\n        category: state.categories.value,\n        category_display: state.category_displays.selected,\n        duration_unit: state.duration_unit.value,\n        pip: symbol.pip,\n    };\n    /* pass data which is needed to show live tick purchase results */\n    extra.show_tick_chart = false;\n    if(_(['digits','callput','asian']).includes(extra.category.contract_category) && state.duration.value === 'Duration' && extra.duration_unit === 'ticks') {\n        extra.digits_value = state.digits.value;\n        extra.tick_count = state.duration_count.value*1;\n        if(extra.category.contract_category !== 'digits') {\n          if (extra.category.contract_category !== 'asian') {\n            extra.tick_count += 1; /* we are shwoing X ticks arfter the initial tick so the total will be X+1 */\n          }\n          /* for higher/lower final barrier value is entry_quote + barrrier */\n          if(extra.category.contract_category === 'callput' && !_(['rise','fall']).includes(extra.category_display.name)) {\n            extra.barrier = state.barriers.barrier;\n          }\n          extra.show_tick_chart = true;\n        }\n    }\n\n    // manually check to see if the user is authenticated or not,\n    // we should update state.currency from user profile first (not everyone is using USD)\n    if(!liveapi.is_authenticated()) {\n        $.growl.error({ message: 'Please log in'.i18n() });\n        state.purchase.loading = false;\n        return;\n    }\n    try {\n        const [tradeConf] = await require(['trade/tradeConf']);\n        const data = await liveapi.send({\n                buy: state.proposal.id,\n                price: state.proposal.ask_price * 1,\n             });\n        extra.contract_id = data.buy.contract_id;\n        extra.transaction_id = data.buy.transaction_id;\n        if(extra.show_tick_chart || extra.category.contract_category === 'digits') {\n          liveapi.proposal_open_contract.subscribe(extra.contract_id);\n        }\n        tradeConf.init(data, extra, show, hide, symbol);\n    }\n    catch(err) {\n        state.purchase.loading = false;\n        $.growl.error({ message: err.message });\n        console.error(err);\n        /*Logout if the error code is 42*/\n        if (err.code === 'InvalidToken') {\n          liveapi.invalidate();\n        } else {\n          /* trigger a new proposal stream */\n          state.proposal.onchange();\n        }\n    }\n  };\n\n  _(available).map('contract_category_display').uniq().value().forEach(x => {\n    let y = {}; \n    y.contract_category_display = x; \n    let contract_object = _.find(available, {contract_category_display: x});\n    if(contract_object){\n      y.contract_category = contract_object.contract_category;\n      state.categories.array.push(y);\n    }\n  });\n\n  state.categories.value = _(state.categories.array).head(); // TODO: show first tab\n  state.categories.selected = state.categories.value.contract_category;\n\n  var tick_stream_alive = false;\n  /* register for tick stream of the corresponding symbol */\n  liveapi.events.on('tick', function (data) {\n      if (data.tick && data.tick.symbol == state.proposal.symbol) {\n          tick_stream_alive = true;\n          // if(state.purchase.loading) return; /* don't update ui while loading confirmation dialog */\n          state.tick.perv_quote = state.tick.quote;\n          state.tick.epoch = data.tick.epoch;\n          state.tick.quote = data.tick.quote;\n          state.ticks.loading = false;\n          /* update ticks for sparkline chart */\n          if(state.ticks.array.length > 25) {\n            state.ticks.array.shift();\n          }\n          state.ticks.array.push(data.tick);\n      }\n  });\n  /* register for proposal event */\n  liveapi.events.on('proposal', function (data) {\n      // Specifically for microsoft products. Need to wait for other functions to finish\n      //We can move the code out of the defer function once windows becomes obsolete or if it stops making browsers. >.<\n      _.defer(function(){\n          if (!data.proposal || data.proposal.id !== state.proposal.id) return;\n          if(data.error){\n            console.error(data.error);\n            state.proposal.error = data.error.message;\n            state.proposal.message = '';\n            return;\n          }\n          if(state.purchase.loading) return; /* don't update ui while loading confirmation dialog */\n          /* update fields */\n          var proposal = data.proposal;\n          state.proposal.ask_price = proposal.ask_price;\n          state.proposal.date_start = proposal.date_start;\n          state.proposal.display_value = proposal.display_value;\n          state.proposal.message = proposal.longcode;\n          state.proposal.payout = proposal.payout;\n          state.proposal.spot = proposal.spot;\n          state.proposal.spot_time = proposal.spot_time;\n          state.spreads.spread = proposal.spread || 0.0;\n          state.spreads.spot = proposal.spot || '0.0';\n          state.spreads.spot_time = proposal.spot_time || '0';\n          state.proposal.loading = false;\n          if(!tick_stream_alive && proposal.spot) { /* for contracts that don't have live qoute data */\n            state.tick.epoch = proposal.spot_time;\n            state.tick.quote = proposal.spot;\n          }\n      });\n  });\n\n  liveapi.events.on('set_account_currency', update_currency);\n\n  update_currency();\n\n  return state;\n}\nexport function init(symbol, contracts_for, saved_template, isTrackerInitiated) {\n    var root = $(html).i18n();\n    var available = apply_fixes(contracts_for.available);\n\n    var dialog = windows.createBlankWindow(root, {\n        title: symbol.display_name,\n        width: 355,\n        resizable: false,\n        collapsable: false,\n        minimizable: true,\n        maximizable: false,\n        'data-authorized': 'true',\n        isTrackerInitiated: isTrackerInitiated,\n        relativePosition: true,\n        close: function() {\n          /* forget last proposal stream on close */\n          if(state.proposal.last_promise) {\n            state.proposal.last_promise.then(function(data){\n              var id = data.proposal && data.proposal.id;\n              id && liveapi.send({forget: id});\n            });\n          }\n          chartingRequestMap.unregister(key);\n          view.unbind();\n          dialog.destroy();\n        }\n    });\n    var update_track = dialog.track({\n      module_id: 'tradeDialog',\n      is_unique: false,\n      data: {\n        symbol : symbol,\n        template: saved_template || {}\n      }\n    });\n\n    /********************** register for ticks_streams **********************/\n    var key = chartingRequestMap.keyFor(symbol.symbol, /* granularity = */ 0);\n    var has_digits = _(available).map('min_contract_duration')\n                      .some(function(duration){ return /^\\d+$/.test(duration) || (_.last(duration) === 't'); });\n    if(!chartingRequestMap[key]){ /* don't register if already someone else has registered for this symbol */\n        chartingRequestMap.register({\n          symbol: symbol.symbol,\n          subscribe: 1,\n          granularity: 0,\n          style: 'ticks'\n        }).catch(function (err) {\n          /* if this contract offers tick trades, prevent user from trading */\n          if(has_digits) {\n            $.growl.error({ message: err.message });\n            _.delay(function(){ dialog.dialog('close'); },2000);\n          }\n          console.error(err);\n        });\n    }\n    else { chartingRequestMap.subscribe(key); }\n\n    var state = init_state(available,root,dialog, symbol, contracts_for.spot);\n    if(!has_digits) { state.ticks.loading = false; }\n    var view = rv.bind(root[0],state);\n    state.categories.update();            // trigger update to init categories_display submenu\n\n    dialog.dialog('open');\n\n    dialog.update_track = function(template) {\n      update_track({symbol: symbol, template: template});\n    };\n    dialog.get_template = get_current_template.bind(undefined, state);\n    dialog.set_template = set_current_template.bind(undefined, state);\n    saved_template && (saved_template.name !== undefined) && dialog.set_template(saved_template);\n    dialog.hide_template_menu = () => { state.template.visible = false; };\n    require(['trade/tradeTemplateManager'], function(tradeTemplateManager) {\n      tradeTemplateManager.init(root.find('.trade-template-manager-root'), dialog);\n    });\n    // window.state = state; window.av = available; window.moment = moment; window.dialog = dialog; window.times_for = trading_times_for;\n    return dialog; // used in tracker to set position.\n}\n\nexport default { init, };\n"]}