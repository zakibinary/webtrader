CCI=function(a,b,c){b.maType=(b.maType||"SMA").toUpperCase(),IndicatorBase.call(this,a,b,c),this.tpData=[],this.priceData=[],this.CalculateCCIValue=function(a,b){for(var c=0,d=0;d<this.options.period-1;d++)c+=Math.abs(this.tpMa.indicatorData[b].value-this.tpData[b-d].close);var e=c/this.options.period,f=toFixed((this.tpData[b].close-this.tpMa.indicatorData[b].value)/(.015*e),4);return f};for(var d=0;d<a.length;d++){var e=(a[d].high+a[d].low+a[d].close)/3;this.tpData.push({time:a[d].time,close:e})}b.appliedTo=this.indicators.CLOSE,this.tpMa=new window[this.options.maType](this.tpData,b,c);for(var d=0;d<a.length;d++){if(d>=this.options.period-1){var f=this.CalculateCCIValue(a,d,!1);this.indicatorData.push({time:a[d].time,value:f})}else this.indicatorData.push({time:a[d].time,value:0});this.priceData.push(a[d])}},CCI.prototype=Object.create(IndicatorBase.prototype),CCI.prototype.constructor=CCI,CCI.prototype.addPoint=function(a){this.priceData.push(a);var b=this.priceData.length-1,c=(this.priceData[b].high+this.priceData[b].low+this.priceData[b].close)/3;this.tpData.push({time:a.time,close:c}),this.tpMa.addPoint(this.tpData[b]);var d=this.CalculateCCIValue(this.priceData,this.priceData.length-1,!1);return this.indicatorData.push({time:a.time,value:d}),[{id:this.uniqueID,value:d}]},CCI.prototype.update=function(a){var b=this.priceData.length-1;this.priceData[b].open=a.open,this.priceData[b].high=a.high,this.priceData[b].low=a.low,this.priceData[b].close=a.close;var c=(this.priceData[b].high+this.priceData[b].low+this.priceData[b].close)/3;this.tpData[b].close=c,this.tpMa.update(this.tpData[b]);var d=this.CalculateCCIValue(this.priceData,b,!1);return this.indicatorData[b].value=d,[{id:this.uniqueID,value:d}]},CCI.prototype.toString=function(){return"CCI ("+this.options.period+", "+this.indicators.appliedPriceString(this.options.appliedTo)+")"};