T3=function(a,b,c){IndicatorBase.call(this,a,b,c),this.ema1={},this.ema2={},this.gd1=[],this.gd2=[],this.gd3=[],this.priceData=[],this.CalculateGD=function(a,b,c,d){this.ema1[b]=new EMA(a,{period:this.options.period,appliedTo:d},this.indicators);var e=[];this.ema1[b].indicatorData.forEach(function(a){e.push({time:a.time,close:a.value})}),this.ema2[b]=new EMA(e,{period:this.options.period,appliedTo:this.indicators.CLOSE},this.indicators);var f=[],g=0,h=this.options.vFactor;this.ema2[b].indicatorData.forEach(function(a){f.push({time:a.time,close:a.value});var b=e[g].close*(1+h)-a.value*h;c.push({time:a.time,close:b}),g++})},this.UpdateT3=function(a,b,c,d){var e=this.ema1[c].update(a)[0].value,f=this.ema2[c].update({time:a.time,close:e})[0].value,g=e*(1+this.options.vFactor)-f*this.options.vFactor;return d[b]={time:a.time,close:g},{time:a.time,close:toFixed(g,4)}},this.CalculateGD(a,"gd1",this.gd1,this.options.appliedTo),this.CalculateGD(this.gd1,"gd2",this.gd2,this.indicators.CLOSE),this.CalculateGD(this.gd2,"gd3",this.gd3,this.indicators.CLOSE);for(var d=0;d<a.length;d++)this.indicatorData.push({time:this.gd3[d].time,value:toFixed(this.gd3[d].close,4)||null}),this.priceData.push(a[d])},T3.prototype=Object.create(IndicatorBase.prototype),T3.prototype.constructor=T3,AddT3=function(a,b,c,d){var e=this.ema1[c].addPoint(a)[0].value,f=this.ema2[c].addPoint({time:a.time,close:e})[0].value,g=e*(1+this.options.vFactor)-f*this.options.vFactor;return d.push({time:a.time,close:g}),{time:a.time,close:toFixed(g,4)}},T3.prototype.addPoint=function(a){this.priceData.push(a);var b=this.priceData.length-1,c=AddT3.call(this,a,b,"gd1",this.gd1),d=AddT3.call(this,c,b,"gd2",this.gd2),e=AddT3.call(this,d,b,"gd3",this.gd3);return this.indicatorData.push({time:a.time,value:e.close}),[{id:this.uniqueID,value:e.close}]},T3.prototype.update=function(a){var b=this.priceData.length-1;this.priceData[b].open=a.open,this.priceData[b].high=a.high,this.priceData[b].low=a.low,this.priceData[b].close=a.close;var b=this.priceData.length-1,c=this.UpdateT3(a,b,"gd1",this.gd1),d=this.UpdateT3(c,b,"gd2",this.gd2),e=this.UpdateT3(d,b,"gd3",this.gd3);return this.indicatorData.push({time:a.time,value:e.close}),[{id:this.uniqueID,value:e.close}]},T3.prototype.toString=function(){return"T3 ("+this.options.period+", "+this.indicators.appliedPriceString(this.options.appliedTo)+")"};