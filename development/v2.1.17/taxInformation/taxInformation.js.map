{"version":3,"sources":["../../../../src/taxInformation/taxInformation.es6"],"names":["win","init","Promise","all","cached","send","residence_list","then","data","createBlankWindow","i18n","title","width","height","resizable","collapsable","minimizable","maximizable","closable","closeOnEscape","modal","ignoreTileAction","close","dialog","state","empty_fields","show","validate","clear","debounce","place_of_birth","value","tax_residence","tax_identification_number","country_array","submit_disabled","cancel","invalidate","submit","isValid","request","get_settings","address_line_1","address_city","phone","set_settings","join","growl","notice","message","catch","err","console","log","error","msg","test","bind"],"mappings":"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","file":"taxInformation.js","sourcesContent":["import 'css!taxInformation/taxInformation.css';\nimport rv from 'common/rivetsExtra';\nimport $ from 'jquery';\nimport windows from 'windows/windows';\nimport $html from 'text!./taxInformation.html';\nimport liveapi from 'websockets/binary_websockets';\nimport _ from \"lodash\";\nimport 'common/util';\nimport 'jquery-growl'\nlet win = null;\n\nexport const init = () => {\n    Promise.all([liveapi.cached.send({ \"get_settings\": 1 }), liveapi.send({ residence_list: 1 })]).then((data) => {\n        win = windows.createBlankWindow($($html).i18n(), {\n            title: \"Tax Information\".i18n(),\n            width: 700,\n            height: 'auto',\n            resizable: false,\n            collapsable: false,\n            minimizable: false,\n            maximizable: false,\n            closable: true,\n            closeOnEscape: false,\n            modal: true,\n            ignoreTileAction: true,\n            'data-authorized': 'true',\n            close: () => {\n                win.dialog('destroy');\n                win = null\n            }\n        });\n        const state = {\n            empty_fields: {\n                show: () => {\n                    state.empty_fields.validate = true;\n                    state.empty_fields.clear();\n                },\n                clear: _.debounce(function () {\n                    state.empty_fields.validate = false;\n                }, 4000),\n                validate: false\n            },\n            place_of_birth: data[1].residence_list[0].value,\n            tax_residence: '',\n            tax_identification_number: null,\n            country_array: data[1].residence_list,\n            submit_disabled: false,\n            cancel: () => {\n                liveapi.invalidate();\n                win.dialog('close');\n            },\n            submit: () => {\n                if (!state.isValid()) {\n                    state.empty_fields.show();\n                    return;\n                }\n                state.submit_disabled = true;\n                const request = data[0].get_settings;\n\n                liveapi.send({\n                    address_line_1: request.address_line_1,\n                    address_city: request.address_city,\n                    phone: request.phone,\n                    place_of_birth: state.place_of_birth,\n                    set_settings: 1,\n                    tax_identification_number: state.tax_identification_number,\n                    tax_residence: state.tax_residence.join(\",\")\n                }).then(() => {\n                    $.growl.notice({ message: \"Tax Information successfully updated\".i18n() });\n                    win.dialog(\"close\");\n                }).catch((err) => {\n                    console.log(err);\n                    $.growl.error({ message: err.msg })\n                })\n            },\n            isValid: () => {\n                return state.place_of_birth && state.tax_residence && state.tax_identification_number &&\n                    /^[\\w-]{0,20}$/.test(state.tax_identification_number)\n            }\n        }\n        rv.bind(win, state);\n        win.dialog(\"open\");\n    }).catch((err) => {\n        console.log(err);\n        $.growl.error({ message: err.msg })\n    });\n}\n\nexport default {\n    init\n}"]}