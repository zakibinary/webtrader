CMO=function(a,b,c){IndicatorBase.call(this,a,b,c),this.priceData=[],this.CalculateCMOValue=function(a){for(var b=0,c=0,d=0;d<this.options.period;d++)b+=this.posData[a-d].value,c+=this.negData[a-d].value;return{sumPos:b,sumNeg:c}},this.CalculatePosNegValue=function(a,b){var c=this.indicators.getIndicatorOrPriceValue(a[b],this.options.appliedTo)-this.indicators.getIndicatorOrPriceValue(a[b-1],this.options.appliedTo),d=0,e=0;return c>0&&(d=c),0>c&&(e=Math.abs(c)),{pos:d,neg:e}},this.posData=[{time:a[0].time,close:0}],this.negData=[{time:a[0].time,close:0}];for(var d=1;d<a.length;d++){var e=this.CalculatePosNegValue(a,d);this.posData.push({time:a[d].time,value:e.pos}),this.negData.push({time:a[d].time,value:e.neg})}for(var d=0;d<a.length;d++){if(d>=this.options.period-1){var f=this.CalculateCMOValue(d),g=0;f.sumPos+f.sumNeg!==0&&(g=toFixed((f.sumPos-f.sumNeg)/(f.sumPos+f.sumNeg)*100,4)),this.indicatorData.push({time:a[d].time,value:g})}else this.indicatorData.push({time:a[d].time,value:0});this.priceData.push(a[d])}},CMO.prototype=Object.create(IndicatorBase.prototype),CMO.prototype.constructor=CMO,CMO.prototype.addPoint=function(a){this.priceData.push(a);var b=this.priceData.length-1,c=this.CalculatePosNegValue(this.priceData,b);this.posData.push({time:a.time,value:c.pos}),this.negData.push({time:a.time,value:c.neg});var d=this.CalculateCMOValue(b),e=d.sumPos+d.sumNeg!==0?toFixed((d.sumPos-d.sumNeg)/(d.sumPos+d.sumNeg)*100,4):0;return this.indicatorData.push({time:a.time,value:e}),[{id:this.uniqueID,value:e}]},CMO.prototype.update=function(a){var b=this.priceData.length-1;this.priceData[b].open=a.open,this.priceData[b].high=a.high,this.priceData[b].low=a.low,this.priceData[b].close=a.close;var c=this.CalculatePosNegValue(this.priceData,b);this.posData[b].value=c.pos,this.negData[b].value=c.neg;var d=this.CalculateCMOValue(b),e=d.sumPos+d.sumNeg!==0?toFixed((d.sumPos-d.sumNeg)/(d.sumPos+d.sumNeg)*100,4):0;return this.indicatorData[b].value=e,[{id:this.uniqueID,value:e}]},CMO.prototype.toString=function(){return"CMO ("+this.options.period+", "+this.indicators.appliedPriceString(this.options.appliedTo)+")"};