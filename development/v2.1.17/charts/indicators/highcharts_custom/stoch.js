STOCH=function(a,b,c){b.fastDMaType=(b.fastDMaType||"SMA").toUpperCase(),IndicatorBase.call(this,a,b,c),this.priceData=[],this.uniqueID=[uuid(),uuid()],this.calculateStochValue=function(a,b){for(var c=a[b].low,d=a[b].high,e=0;e<this.options.fastKPeriod;e++)c=Math.min(a[b-e].low,c),d=Math.max(a[b-e].high,d);var f=0;return d-c!==0&&(f=(this.indicators.getIndicatorOrPriceValue(a[b],this.options.appliedTo)-c)/(d-c)*100),toFixed(f,4)};for(var d=0;d<a.length;d++){if(d>=this.options.fastKPeriod){var e=this.calculateStochValue(a,d);this.indicatorData.push({time:a[d].time,value:e,close:e})}else this.indicatorData.push({time:a[d].time,value:0,close:0});this.priceData.push(a[d])}this.dData=new window[b.fastDMaType](this.indicatorData,{period:this.options.fastDPeriod,maType:this.options.fastDMaType},c)},STOCH.prototype=Object.create(IndicatorBase.prototype),STOCH.prototype.constructor=STOCH,STOCH.prototype.addPoint=function(a){this.priceData.push(a);var b=this.priceData.length-1,c=this.calculateStochValue(this.priceData,b),d=this.dData.addPoint({time:a.time,close:c})[0].value;return this.indicatorData.push({time:a.time,value:c}),[{id:this.uniqueID[0],value:c},{id:this.uniqueID[1],value:d}]},STOCH.prototype.update=function(a){var b=this.priceData.length-1;this.priceData[b].open=a.open,this.priceData[b].high=a.high,this.priceData[b].low=a.low,this.priceData[b].close=a.close;var c=this.calculateStochValue(this.priceData,b),d=this.dData.update({time:a.time,close:c})[0].value;return this.indicatorData[b].value=c,[{id:this.uniqueID[0],value:c},{id:this.uniqueID[1],value:d}]},STOCH.prototype.toString=function(){return"STOCH ("+this.options.fastKPeriod+", "+this.options.fastDPeriod+", "+this.indicators.appliedPriceString(this.options.appliedTo)+")"},STOCH.prototype.buildSeriesAndAxisConfFromData=function(a){var b=[];this.indicatorData.forEach(function(a){b.push([a.time,a.value])});var c=[];return this.dData.indicatorData.forEach(function(a){c.push([a.time,a.value])}),[{axisConf:{id:a.id+"-"+this.uniqueID[0],title:{text:this.toString(),align:"high",offset:0,rotation:0,y:10,x:30+7.5*this.toString().length},lineWidth:2,plotLines:this.options.levels}},{seriesConf:{id:this.uniqueID[0],name:this.toString(),data:b,type:"line",yAxis:a.id+"-"+this.uniqueID[0],color:this.options.stroke,lineWidth:this.options.strokeWidth,dashStyle:this.options.dashStyle,onChartIndicator:!1}},{seriesConf:{id:this.uniqueID[1],name:"%D",data:c,type:"line",yAxis:a.id+"-"+this.uniqueID[0],color:this.options.dStroke,lineWidth:this.options.strokeWidth,dashStyle:this.options.dashStyle,onChartIndicator:!1}}]},STOCH.prototype.getIDs=function(){return this.uniqueID},STOCH.prototype.isSameInstance=function(a){return _.isEqual(a.sort(),this.uniqueID)};