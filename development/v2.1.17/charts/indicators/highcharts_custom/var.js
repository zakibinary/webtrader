VAR=function(a,b,c){_.isUndefined(b.appliedTo)&&(b.appliedTo=c.CLOSE),IndicatorBase.call(this,a,b,c),this.sma=new SMA(a,b,c),this.priceData=[],this.CalculateVARValue=function(a,b){for(var d=0,e=this.options.period-1;e>=0;e--)d+=Math.pow(c.getIndicatorOrPriceValue(a[b-e],this.options.appliedTo)-this.sma.indicatorData[b-e].value,2);var f=d/(this.options.period-1);return toFixed(f,4)};for(var d=0;d<a.length;d++){if(d>=b.period){var e=this.CalculateVARValue(a,d);this.indicatorData.push({time:a[d].time,value:e})}else this.indicatorData.push({time:a[d].time,value:0});this.priceData.push(a[d])}},VAR.prototype=Object.create(IndicatorBase.prototype),VAR.prototype.constructor=VAR,VAR.prototype.addPoint=function(a){this.priceData.push(a),this.sma.addPoint(a);var b=this.priceData.length-1,c=this.CalculateVARValue(this.priceData,b);return this.indicatorData.push({time:a.time,value:c}),[{id:this.uniqueID,value:c}]},VAR.prototype.update=function(a){var b=this.priceData.length-1;this.priceData[b].open=a.open,this.priceData[b].high=a.high,this.priceData[b].low=a.low,this.priceData[b].close=a.close,this.sma.update(a);var c=this.CalculateVARValue(this.priceData,b);return this.indicatorData[b].value=c,[{id:this.uniqueID,value:c}]},VAR.prototype.toString=function(){return"VAR ("+this.options.period+")"};