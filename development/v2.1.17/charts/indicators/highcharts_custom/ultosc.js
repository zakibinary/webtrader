ULTOSC=function(a,b,c){IndicatorBase.call(this,a,b,c),this.priceData=[],this.BP=[],this.TR=[],this.CalculateAVG=function(a,b){for(var c=0,d=0,e=0;b>e;e++)c+=this.BP[a-e].value,d+=this.TR[a-e].value;return c/d},this.CalculateBRTRValue=function(a,b){var c=this.indicators.getIndicatorOrPriceValue(a[b],this.options.appliedTo),d=b-1>=0?this.indicators.getIndicatorOrPriceValue(a[b-1],this.options.appliedTo):0,e=c-Math.min(a[b].low,d),f=Math.max(a[b].high,d)-Math.min(a[b].low,d);return{bp:e,tr:f}};for(var d=0;d<a.length;d++){var e=this.CalculateBRTRValue(a,d);this.BP.push({time:a[d].time,value:e.bp}),this.TR.push({time:a[d].time,value:e.tr})}for(var d=0;d<a.length;d++){if(d>=this.options.thirdPeriod){var f=this.CalculateAVG(d,this.options.firstPeriod),g=this.CalculateAVG(d,this.options.secondPeriod),h=this.CalculateAVG(d,this.options.thirdPeriod),i=toFixed(100*(4*f+2*g+h)/7,4);this.indicatorData.push({time:a[d].time,value:i})}else this.indicatorData.push({time:a[d].time,value:0});this.priceData.push(a[d])}},ULTOSC.prototype=Object.create(IndicatorBase.prototype),ULTOSC.prototype.constructor=ULTOSC,ULTOSC.prototype.addPoint=function(a){this.priceData.push(a);var b=this.priceData.length-1,c=this.CalculateBRTRValue(this.priceData,b);this.BP.push({time:a.time,value:c.bp}),this.TR.push({time:a.time,value:c.tr});var d=this.CalculateAVG(b,this.options.firstPeriod),e=this.CalculateAVG(b,this.options.secondPeriod),f=this.CalculateAVG(b,this.options.thirdPeriod),g=toFixed(100*(4*d+2*e+f)/7,4);return this.indicatorData.push({time:a.time,value:g}),[{id:this.uniqueID,value:g}]},ULTOSC.prototype.update=function(a){var b=this.priceData.length-1;this.priceData[b].open=a.open,this.priceData[b].high=a.high,this.priceData[b].low=a.low,this.priceData[b].close=a.close;var c=this.CalculateBRTRValue(this.priceData,b);this.BP[b].value=c.bp,this.TR[b].value=c.tr;var d=this.CalculateAVG(b,this.options.firstPeriod),e=this.CalculateAVG(b,this.options.secondPeriod),f=this.CalculateAVG(b,this.options.thirdPeriod),g=toFixed(100*(4*d+2*e+f)/7,4);return this.indicatorData[b].value=g,[{id:this.uniqueID,value:g}]},ULTOSC.prototype.toString=function(){return"ULTOSC ("+this.options.firstPeriod+", "+this.options.secondPeriod+", "+this.options.thirdPeriod+", "+this.indicators.appliedPriceString(this.options.appliedTo)+")"};