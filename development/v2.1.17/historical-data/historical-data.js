define(["exports","jquery","../windows/windows","../websockets/binary_websockets","moment","webtrader-charts","text!./historical-data.html","lodash","../instruments/instruments","highstock-release/modules/offline-exporting","common/util","jquery-ui","css!./historical-data.css"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(a,"__esModule",{value:!0}),a.init=a.createWindow=void 0;var k=j(b),l=j(c),m=(j(d),j(e)),n=j(f),o=j(g),p=j(h),q=null,r=function v(a,b,c){var d=i.getMarketData();if(!d||!d.length)return void p["default"].delay(function(){return v(a,b,c)},1e3);var e='<ul class="primary-color">'+d.map(function(a){return"<li><div>"+a.display_name+'</div><ul class="primary-color">'+a.submarkets.map(function(a){return"<li><div>"+a.display_name+'</div><ul class="primary-color">'+a.instruments.map(function(a){return"<li symbol='"+a.symbol+"'><div>"+a.display_name+"</div></li>"}).join("")+"</ul></li>"}).join("")+"</ul></li>"}).join("")+"</ul>",f=k["default"](e);f.find("li[symbol]").on("click",function(a){var b=k["default"](a.target).text(),d=k["default"](a.target).closest("li").attr("symbol");g.find(".title").text(b),c(d,b)});var g=k["default"]("<div class='instrumnet-dropdown' ><div class='title'>"+b+"</div>");a.closest(".ui-dialog").append(g),g.append(f),f.menu()},s=function(a,b,c){var d=k["default"]('<div class=\'date-time\'>\n                    <input type="button" class="date" tab-index="-1"></input>\n                    <input type="button" class="time" value="00:00"></input>\n          </div>');b.closest(".ui-dialog").append(d),d.find(".date").datepicker({changeMonth:!0,numberOfMonths:1,changeYear:!0,dateFormat:"yy-mm-dd",showButtonPanel:!0,onSelect:function(){k["default"](this).change(),e()},beforeShow:function(b,c){p["default"].delay(function(){return c.dpDiv.css({marginLeft:"-60px",top:d.find(".date").offset().top+35,left:d.find(".date").offset().left,zIndex:1*a.closest(".ui-dialog").css("z-index")+1})})},minDate:m["default"].utc().subtract(1,"years").toDate(),maxDate:m["default"].utc().toDate(),closeText:"Done".i18n(),currentText:"Today".i18n()}).datepicker("setDate",m["default"].utc().subtract(1,"years").toDate().toISOString().slice(0,10)),d.find(".time").timepicker({showCloseButton:!0,beforeShow:function(a,b){return b.tpDiv.css({marginLeft:"-120px"})},onSelect:function(){k["default"](this).change(),e()}});var e=function(){var a=d.find(".date").val(),b=d.find(".time").val(),e=1*m["default"](a+" "+b+" +0000","YYYY-MM-DD HH:mm Z").unix();c&&c(e)}},t=a.createWindow=function(a){var b=a,c=k["default"](o["default"]);a=k["default"].extend({title:"Historical Data For".i18n(),relativePosition:!0,dialogClass:"historical-data-dialog",close:function(){d.actions.destroy(),k["default"](this).dialog("destroy").remove(),q=null},resize:function(){return d&&d.actions.reflow()},width:700,height:400,open:function(){k["default"](this);k["default"](this).parent().promise().done(function(){return d.actions.reflow()})}},a),q=l["default"].createBlankWindow(c,a);var d=null,e=function(){d&&d.actions.destroy(),d=null,d=n["default"].chartWindow.addNewChart(c,b),d.actions.reflow(),d.events.anyChange=function(){b=d.data()}};e(),r(c,b.instrumentName,function(a,c){b.instrumentName=c,b.instrumentCode=a,e()}),s(q,c,function(a){b.start=a,e()});q.track({module_id:"historicalData",is_unique:!0,data:null});return q.dialog("open"),q},u=a.init=function(a){a.click(function(){q&&q.moveToTop()||t({instrumentCode:"frxAUDJPY",instrumentName:"AUD/JPY",timePeriod:"1d",type:"candlestick",showInstrumentName:!0,showOverlays:!1,indicators:[],overlays:[],start:1*m["default"].utc().subtract(1,"years").startOf("day").unix()})})};a["default"]={init:u}});