MAMA=function(a,b,c){IndicatorBase.call(this,a,b,c),this.priceData=[],this.smooth=[],this.detrender=[],this.period=[],this.I1=[],this.Q1=[],this.I2=[],this.Q2=[],this.Re=[],this.Im=[],this.smoothPeriod=[],this.phase=[],this.CalculateMAMAValue=function(a,b){var c=this.indicators.getIndicatorOrPriceValue(a[b],this.options.appliedTo);if(10>=b)this.smooth.push(0),this.detrender.push(0),this.I1.push(0),this.Q1.push(0),this.I2.push(0),this.Q2.push(0),this.Re.push(0),this.Im.push(0),this.period.push(0),this.smoothPeriod.push(0),this.phase.push(0);else if(b>10){this.smooth.push((4*this.indicators.getIndicatorOrPriceValue(a[b],this.options.appliedTo)+3*this.indicators.getIndicatorOrPriceValue(a[b-1],this.options.appliedTo)+2*this.indicators.getIndicatorOrPriceValue(a[b-2],this.options.appliedTo)+1*this.indicators.getIndicatorOrPriceValue(a[b-3],this.options.appliedTo))/10),this.detrender.push((.0962*this.smooth[b]+.5769*this.smooth[b-2]+.5769*this.smooth[b-4]+.0962*this.smooth[b-6])*(.075*this.period[b-1]+.054)),this.Q1.push((.0962*this.detrender[b]+.5769*this.detrender[b-2]+.5769*this.detrender[b-4]+.0962*this.detrender[b-6])*(.075*this.period[b-1]+.054)),this.I1.push(this.detrender[b-3]);var d=(.0962*this.I1[b]+.5769*this.I1[b-2]+.5769*this.I1[b-4]+.0962*this.I1[b-6])*(.075*this.period[b-1]+.054),e=(.0962*this.Q1[b]+.5769*this.Q1[b-2]+.5769*this.Q1[b-4]+.0962*this.Q1[b-6])*(.075*this.period[b-1]+.054);this.I2.push(this.I1[b]-e),this.Q2.push(this.Q1[b]+d),this.I2[b]=.2*this.I2[b]+.8*this.I2[b-1],this.Q2[b]=.2*this.Q2[b]+.8*this.Q2[b-1],this.Re.push(this.I2[b]*this.I2[b-1]+this.Q2[b]*this.Q2[b-1]),this.Im.push(this.I2[b]*this.Q2[b-1]-this.Q2[b]*this.I2[b-1]),this.Re[b]=.2*this.Re[b]+.8*this.Re[b-1],this.Im[b]=.2*this.Im[b]+.8*this.Im[b-1],this.period.push(0),0!==this.Im[b]&&0!==this.Re[b]&&(this.period[b]=360/(57.29577951307855*Math.atan(this.Im[b]/this.Re[b]))),this.period[b]>1.5*this.period[b-1]&&(this.period[b]=1.5*this.period[b-1]),this.period[b]<.67*this.period[b-1]&&(this.period[b]=.67*this.period[b-1]),this.period[b]<6&&(this.period[b]=6),this.period[b]>50&&(this.period[b]=50),this.period[b]=.2*this.period[b]+.8*this.period[b-1],this.smoothPeriod.push(.33*this.period[b]+.67*this.smoothPeriod[b-1]),this.phase.push(0),0!==this.I1[b]&&(this.phase[b]=57.29577951307855*Math.atan(this.Q1[b]/this.I1[b]));var f=this.phase[b-1]-this.phase[b];1>f&&(f=1);var g=this.options.fastLimit/f;g<this.options.slowLimit&&(g=this.options.slowLimit),g>this.options.fastLimit&&(g=this.options.fastLimit),c=g*this.indicators.getIndicatorOrPriceValue(a[b],this.options.appliedTo)+(1-g)*this.indicatorData[b-1].value}return toFixed(c,4)};for(var d=0;d<a.length;d++){var e=this.CalculateMAMAValue(a,d);this.indicatorData.push({time:a[d].time,value:e}),this.priceData.push(a[d])}},MAMA.prototype=Object.create(IndicatorBase.prototype),MAMA.prototype.constructor=MAMA,MAMA.prototype.addPoint=function(a){this.priceData.push(a);var b=this.CalculateMAMAValue(this.priceData,this.priceData.length-1);return this.indicatorData.push({time:a.time,value:b}),[{id:this.uniqueID,value:b}]},MAMA.prototype.update=function(a){var b=this.priceData.length-1;this.priceData[b].open=a.open,this.priceData[b].high=a.high,this.priceData[b].low=a.low,this.priceData[b].close=a.close;var c=this.CalculateMAMAValue(this.priceData,b);return this.indicatorData[b].value=c,[{id:this.uniqueID,value:c}]},MAMA.prototype.toString=function(){return"MAMA ("+this.indicators.appliedPriceString(this.options.appliedTo)+")"};